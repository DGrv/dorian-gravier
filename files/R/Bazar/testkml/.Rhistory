data.table(read.csv(rP("file:///C:/Users/doria/Downloads/gdrive/RR/2025/20250419__GP_Osterhas/Sample_data/VIVI_Elite.csv")))
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
# Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, 'BM_Function_v01.r'), encoding='utf-8')
data.table(read.csv(rP("file:///C:/Users/doria/Downloads/gdrive/RR/2025/20250419__GP_Osterhas/Sample_data/VIVI_Elite.csv")))
data <- data.table(read.csv(rP("file:///C:/Users/doria/Downloads/gdrive/RR/2025/20250419__GP_Osterhas/Sample_data/VIVI_Elite.csv")))
u(data$RD_Bib)
data
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
# GP Osterhas -------------------------------------------------------------
# check max lap
steps <- 10
test <- c()
for(i in 1:(110/steps)) {
temp <- paste0('format(Dmax("[Lap',(i*steps-(steps-1)):(i*steps),'.Decimal]+1";"[Contest2Race]="&[Contest2Race]);"hh:mm:ss")', collapse = "")
temp <- substr(temp, 1, nchar(temp) - 6)
test <- c(test, temp)
}
writeClipboard(test)
# check max lap
steps <- 10
test <- c()
for(i in 1:(20/steps)) {
temp <- paste0('"',(i*steps-(steps-1)):(i*steps), '-"&format(Dmax("[Lap',(i*steps-(steps-1)):(i*steps),'.Decimal]+1";"[Contest2Race]="&[Contest2Race]);"hh:mm:ss")&[lf]&', collapse = "")
temp <- substr(temp, 1, nchar(temp) - 6)
test <- c(test, temp)
}
writeClipboard(test)
steps <- 10
test <- c()
for(i in 1:(110/steps)) {
temp <- paste0('"',(i*steps-(steps-1)):(i*steps), '-"&format(Dmax("[Lap',(i*steps-(steps-1)):(i*steps),'.Decimal]+1";"[Contest2Race]="&[Contest2Race]);"hh:mm:ss")&[lf]&', collapse = "")
temp <- substr(temp, 1, nchar(temp) - 6)
test <- c(test, temp)
}
writeClipboard(test)
steps <- 10
test <- c()
for(i in 1:(110/steps)) {
temp <- paste0('"',(i*steps-(steps-1)):(i*steps), '-"&format(Dmax("[Lap',(i*steps-(steps-1)):(i*steps),'.Decimal]+1";"[Contest2Race]="&[Contest2Race]);"hh:mm:ss")&[lf]&', collapse = "")
temp <- substr(temp, 1, nchar(temp) - 6)
test <- c(test, temp)
}
writeClipboard(test)
test <- c()
for(i in 1:(110/steps) ) {
temp <- paste0("L",(i*steps-(steps-1)), "-", (i*steps), "-P")
test <- c(test, temp)
}
test
writeClipboard(test)
test <- c()
for(i in 1:(110/steps) ) {
temp <- paste0("L",(i*steps-(steps-1)), "-", (i*steps))
test <- c(test, temp)
}
test
writeClipboard(test)
# check max lap
steps <- 10
test <- c()
for(i in 1:(110/steps)) {
temp <- paste0('"',(i*steps-(steps-1)):(i*steps), '-"&format(Dmax("[LapAF',(i*steps-(steps-1)):(i*steps),'.Decimal]+1";"[Contest2Race]="&[Contest2Race]);"hh:mm:ss")&[lf]&', collapse = "")
temp <- substr(temp, 1, nchar(temp) - 6)
test <- c(test, temp)
}
writeClipboard(test)
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
readClipboard()
copdat <- read.delim("clipboard")
read.delim("clipboard")
read.table(file = "clipboard", sep = "\t", header=TRUE)
data <- data.table(read.delim("clipboard"))
data[, .N, .(LastName, FirstName)]
data[, .N, .(LastName, FirstName)][N>1]
# setup
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
ToDToDecimal("17:37:30")
ToDToDecimal("17:37:30")
# setup
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
library(lubridate)
library(hms)
ToDToDecimal("17:37:30")
time <- ToDToDecimal("17:37:30")
bib <- c("8","18","67","11","23","56")
p0("https://api.raceresult.com/316629/GKC9UPV2RDNF8LXVJSVLXT7BDP08XB0L"&"?bib=", bib, "&time=", time)
p0("https://api.raceresult.com/316629/GKC9UPV2RDNF8LXVJSVLXT7BDP08XB0L?bib=", bib, "&time=", time)
time <- ToDToDecimal("17:35:11")
bib <- c("8","18","67","11","23","56")
p0("https://api.raceresult.com/316629/GKC9UPV2RDNF8LXVJSVLXT7BDP08XB0L?bib=", bib, "&time=", time)
t <- p0("https://api.raceresult.com/316629/GKC9UPV2RDNF8LXVJSVLXT7BDP08XB0L?bib=", bib, "&time=", time)
writeClipboard(t)
time <- ToDToDecimal("17:35:20")
bib <- c("8","18","67","11","23","56")
t <- p0("https://api.raceresult.com/316629/GKC9UPV2RDNF8LXVJSVLXT7BDP08XB0L?bib=", bib, "&time=", time)
writeClipboard(t)
t <- p0("https://api.raceresult.com/316629/RPQA6LDZJSBY9AIHPFAIAZPKGDCRFHIB?bib=",bib, "&fieldname=Lap81Minus&value=1")
writeClipboard(t)
t <- p0("https://api.raceresult.com/316629/RPQA6LDZJSBY9AIHPFAIAZPKGDCRFHIB?bib=",bib, "&fieldname=Lap81Minus&value=1")
writeClipboard(t)
url <- "https://api.raceresult.com/315977/4TV4B6CVD10OOGLG5KYUUWZ30GFO2PYA"
fromJson(url)
fromJSON(url)
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
# Sys.setlocale('LC_ALL', 'German')
suppressWarnings(suppressMessages(source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")))
url <- "https://api.raceresult.com/315977/4TV4B6CVD10OOGLG5KYUUWZ30GFO2PYA"
fromJSON(url)
results <- data.table(jsonlite::fromJSON(url(url), flatten = TRUE))
results
url(url)
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
# Sys.setlocale('LC_ALL', 'German')
suppressWarnings(suppressMessages(source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")))
url <- "https://api.raceresult.com/315977/4TV4B6CVD10OOGLG5KYUUWZ30GFO2PYA"
data <- data.table(jsonlite::fromJSON(url(url), flatten = TRUE))
setnames(data, names(data), c("Contest","Firstname","Lastname","Nation","UCI_ID"))
data
data[, .N, UCI_ID][N>1]
data[UCI_ID != "", .N, UCI_ID][N>1]
data[UCI_ID %IN% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID]
data[UCI_ID %in% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID]
data[UCI_ID %in% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID][order(UCI_ID)]
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
# Sys.setlocale('LC_ALL', 'German')
suppressWarnings(suppressMessages(source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")))
url <- "https://api.raceresult.com/315977/4TV4B6CVD10OOGLG5KYUUWZ30GFO2PYA"
data <- data.table(jsonlite::fromJSON(url(url), flatten = TRUE))
setnames(data, names(data), c("Contest","Firstname","Lastname","Nation","UCI_ID", "Bib"))
data[UCI_ID %in% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID][order(UCI_ID)]
data[Contest != 100][UCI_ID %in% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID][order(UCI_ID)]
data[Contest != 100][UCI_ID %in% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID][order(UCI_ID, Contest)]
data[Contest != 100][UCI_ID %in% data[Contest != 100][UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID][order(UCI_ID, Contest)]
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
# library(RecordLinkage)
library(stringdist)
data <- readAll(rP("file:///C:/Users/doria/Downloads/gdrive/RR/2025/2025______SwissBikeCup/BU/rr_backup_Skoda_Swiss_Bike_Cup_2025_20250507-100402/participants.csv"))
data
data[, Name := p0(Lastname, " ", Firstname)]
data <- data[, .(Contest, Name)]
lcontest <- u(data$Contest)
all <- data.table()
for(i in seq_along(lcontest)) {
data2 <- data[Contest == lcontest[i]]
data3 <- data.table(expand.grid(data2$Name, data2$Name))
data3[, Var1 := as.character.factor(Var1)]
data3[, Var2 := as.character.factor(Var2)]
data3[, dist := stringsim(Var1, Var2)]
data3 <- data3[dist != 1][dist > 0.5]
data3 <- data3[order(-dist)]
data3[, Contest := lcontest[i]]
all <- rbind(all, data3)
all <- all[order(-dist)]
}
all[1:50]
wd <- rP("file:///C:/Users/doria/Downloads/testkml//")
wdout <- wd
# setup
rm(list = ls())
rootpath <- "C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/"
Sys.setlocale("LC_ALL", "German")
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
suppressWarnings(suppressMessages(library(leaflet)))
suppressWarnings(suppressMessages(library(leaflet.extras)))
# suppressWarnings(suppressMessages(library(rayshaderanimate)))
suppressWarnings(suppressMessages(library(htmlwidgets)))
suppressWarnings(suppressMessages(library(RColorBrewer)))
suppressWarnings(suppressMessages(library(sf)))
suppressWarnings(suppressMessages(library(gpx)))
suppressWarnings(suppressMessages(library(xml2)))
# display.brewer.all()
wd <- rP("file:///C:/Users/doria/Downloads/testkml/")
wdout <- wd
setwd(wd)
cat("\nwd = ", wd)
ll <- data.table(path = list.files(wd, pattern = "gpx$", full = T, recursive = T))
ll[, file := basename(path)]
ll[, What := basename(dirname(path))]
ll[, colorID := .GRP, What]
ll[, .N, colorID]
ll[, color := brewer.pal(n = length(u(ll$colorID)), name = "Set1")[colorID]]
# ll[, color := qualitative_hcl(length(u(ll$colorID)), palette = "Dark 3")[colorID]]
ll[, .N, .(colorID, color)]
ll[, desc := p0(file, '<br><a target="_blank" href="https://raw.githubusercontent.com/DGrv/dorian-gravier/refs/heads/master/files/gpx/', What, "/", file, '" download>Download</a>')]
ll <- ll[What!= "time"]
data <- data.table()
for (i in seq_along(ll$path)) {
cat(i, "- Try:", ll$file[i])
temp <- read.gpx(ll$path[i], type="trk")
temp[, file := ll$file[i]]
temp[, What := ll$What[i]]
temp[, isStart := F]
temp[1, isStart := T]
data <- rbind(data, temp, fill = T)
cat(green(" - Read done\n"))
}
source(p0(rootpath, "Map_Github/Map_providers.R"))
groupLayers <- c(u(ll$What), "Wild Camping")
ll
groupLayers <- c(u(ll$What))
for(i in seq_along(ll$file)) {
data1 <- st_as_sf(x = data[file == ll$file[i]],
coords = c("lon", "lat"))
data2 <- data1 %>%
st_combine() %>%
st_cast(to = "LINESTRING") %>%
st_sf()
m <- m %>%
addPolylines(data = data2,
group = ll$What[i],
color = ll$color[i],
popup = ll$desc[i],
opacity = ifelse(ll$What[i]=="Stop", 0.4, 1),
weight = 4
# label = ~name
)
}
groupLayers <- c(u(ll$What), "Wild Camping")
for(i in seq_along(ll$file)) {
data1 <- st_as_sf(x = data[file == ll$file[i]],
coords = c("lon", "lat"))
data2 <- data1 %>%
st_combine() %>%
st_cast(to = "LINESTRING") %>%
st_sf()
m <- m %>%
addPolylines(data = data2,
group = ll$What[i],
color = ll$color[i],
popup = ll$desc[i],
opacity = ifelse(ll$What[i]=="Stop", 0.4, 1),
weight = 4
# label = ~name
)
}
zelt <- read.gpx(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/Zelt.gpx"), type = "wpt")
zelt <- zelt[time > "2025-10-13" & time < "2026-02-15"]
rrIcons <- iconList(
camp = makeIcon(
iconUrl = "https://raw.githubusercontent.com/DGrv/dorian-gravier/refs/heads/master/files/icon/camping.png",
iconWidth = 36,
iconHeight = 36
)
)
m <- m %>%
addMarkers(data = zelt, lng = ~lon, lat = ~lat,
group = "Wild Camping",
# color = "#ff3355",
icon = rrIcons["camp"]
# popup = ~SplitName,
# popupOptions = popupOptions(autoClose = TRUE, offset=c(0, -30)),
# opacity = 1,
# radius = 4,
# fillOpacity = 0.5
)
m <- m %>%
addCircleMarkers(data = data[isStart == T], lng = ~lon, lat = ~lat,
group = ll$What[1],
color = ll$color[1],
# popup = ~SplitName,
# popupOptions = popupOptions(autoClose = TRUE, offset=c(0, -30)),
opacity = 1,
radius = 4,
fillOpacity = 0.8)
latMiddle <- (max(data$lat)-min(data$lat))/2+min(data$lat)
lonMiddle <- (max(data$lon)-min(data$lon))/2+min(data$lon)
m <- setView(map=m,
lat= latMiddle,
lng= lonMiddle,
zoom = 5, options = )
m <-  m %>%
# setView(11, 45,  zoom = 6) %>%
addLayersControl(
baseGroups = mapGroups,
overlayGroups = groupLayers,
options = layersControlOptions(collapsed=FALSE)) %>%
addFullscreenControl() %>%
addHash() %>%
addSearchOSM() %>%
addControlGPS() %>%
hideGroup("Wild Camping")
# %>%
# hideGroup(groupslayer[3:length(groupslayer)]) #hide all groups except the 1st and 2nd )
cat("\nLeaflet ready")
setwd(wdout)
outfilename <- "kml.html"
saveWidget(m, file=outfilename)
t <- readLines(outfilename)
idwidget <- gsub('<script type\\="application/htmlwidget-sizing" data-for\\="(.*)">\\{"viewer".*', "\\1", t[length(t)-2])
# change meta that is good phones
# t[t %like% "<meta"]
t <- gsub(t[t %like% "<meta"], '<meta charset="utf-8" />\n<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />', t)
t <- gsub("<title>leaflet</title>", p0("<title>", gsub(".html", "", outfilename), "</title>"), t)
tadd <- readLines(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/RR/Javascript/Copy_MousePosition_v01.html"))
tadd <- gsub("\\#idwidget", p0("#", idwidget), tadd)
t <- c(t[1:(length(t)-2)], tadd, t[(length(t)-1):length(t)])
write.table(t, outfilename, row.names = F, col.names = F, quote = F)
cat("\nLeaflet DONE :)\n")
