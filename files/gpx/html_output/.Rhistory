data.table(read.csv(rP("file:///C:/Users/doria/Downloads/gdrive/RR/2025/20250419__GP_Osterhas/Sample_data/VIVI_Elite.csv")))
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
# Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, 'BM_Function_v01.r'), encoding='utf-8')
data.table(read.csv(rP("file:///C:/Users/doria/Downloads/gdrive/RR/2025/20250419__GP_Osterhas/Sample_data/VIVI_Elite.csv")))
data <- data.table(read.csv(rP("file:///C:/Users/doria/Downloads/gdrive/RR/2025/20250419__GP_Osterhas/Sample_data/VIVI_Elite.csv")))
u(data$RD_Bib)
data
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
# GP Osterhas -------------------------------------------------------------
# check max lap
steps <- 10
test <- c()
for(i in 1:(110/steps)) {
temp <- paste0('format(Dmax("[Lap',(i*steps-(steps-1)):(i*steps),'.Decimal]+1";"[Contest2Race]="&[Contest2Race]);"hh:mm:ss")', collapse = "")
temp <- substr(temp, 1, nchar(temp) - 6)
test <- c(test, temp)
}
writeClipboard(test)
# check max lap
steps <- 10
test <- c()
for(i in 1:(20/steps)) {
temp <- paste0('"',(i*steps-(steps-1)):(i*steps), '-"&format(Dmax("[Lap',(i*steps-(steps-1)):(i*steps),'.Decimal]+1";"[Contest2Race]="&[Contest2Race]);"hh:mm:ss")&[lf]&', collapse = "")
temp <- substr(temp, 1, nchar(temp) - 6)
test <- c(test, temp)
}
writeClipboard(test)
steps <- 10
test <- c()
for(i in 1:(110/steps)) {
temp <- paste0('"',(i*steps-(steps-1)):(i*steps), '-"&format(Dmax("[Lap',(i*steps-(steps-1)):(i*steps),'.Decimal]+1";"[Contest2Race]="&[Contest2Race]);"hh:mm:ss")&[lf]&', collapse = "")
temp <- substr(temp, 1, nchar(temp) - 6)
test <- c(test, temp)
}
writeClipboard(test)
steps <- 10
test <- c()
for(i in 1:(110/steps)) {
temp <- paste0('"',(i*steps-(steps-1)):(i*steps), '-"&format(Dmax("[Lap',(i*steps-(steps-1)):(i*steps),'.Decimal]+1";"[Contest2Race]="&[Contest2Race]);"hh:mm:ss")&[lf]&', collapse = "")
temp <- substr(temp, 1, nchar(temp) - 6)
test <- c(test, temp)
}
writeClipboard(test)
test <- c()
for(i in 1:(110/steps) ) {
temp <- paste0("L",(i*steps-(steps-1)), "-", (i*steps), "-P")
test <- c(test, temp)
}
test
writeClipboard(test)
test <- c()
for(i in 1:(110/steps) ) {
temp <- paste0("L",(i*steps-(steps-1)), "-", (i*steps))
test <- c(test, temp)
}
test
writeClipboard(test)
# check max lap
steps <- 10
test <- c()
for(i in 1:(110/steps)) {
temp <- paste0('"',(i*steps-(steps-1)):(i*steps), '-"&format(Dmax("[LapAF',(i*steps-(steps-1)):(i*steps),'.Decimal]+1";"[Contest2Race]="&[Contest2Race]);"hh:mm:ss")&[lf]&', collapse = "")
temp <- substr(temp, 1, nchar(temp) - 6)
test <- c(test, temp)
}
writeClipboard(test)
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
readClipboard()
copdat <- read.delim("clipboard")
read.delim("clipboard")
read.table(file = "clipboard", sep = "\t", header=TRUE)
data <- data.table(read.delim("clipboard"))
data[, .N, .(LastName, FirstName)]
data[, .N, .(LastName, FirstName)][N>1]
# setup
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
ToDToDecimal("17:37:30")
ToDToDecimal("17:37:30")
# setup
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
library(lubridate)
library(hms)
ToDToDecimal("17:37:30")
time <- ToDToDecimal("17:37:30")
bib <- c("8","18","67","11","23","56")
p0("https://api.raceresult.com/316629/GKC9UPV2RDNF8LXVJSVLXT7BDP08XB0L"&"?bib=", bib, "&time=", time)
p0("https://api.raceresult.com/316629/GKC9UPV2RDNF8LXVJSVLXT7BDP08XB0L?bib=", bib, "&time=", time)
time <- ToDToDecimal("17:35:11")
bib <- c("8","18","67","11","23","56")
p0("https://api.raceresult.com/316629/GKC9UPV2RDNF8LXVJSVLXT7BDP08XB0L?bib=", bib, "&time=", time)
t <- p0("https://api.raceresult.com/316629/GKC9UPV2RDNF8LXVJSVLXT7BDP08XB0L?bib=", bib, "&time=", time)
writeClipboard(t)
time <- ToDToDecimal("17:35:20")
bib <- c("8","18","67","11","23","56")
t <- p0("https://api.raceresult.com/316629/GKC9UPV2RDNF8LXVJSVLXT7BDP08XB0L?bib=", bib, "&time=", time)
writeClipboard(t)
t <- p0("https://api.raceresult.com/316629/RPQA6LDZJSBY9AIHPFAIAZPKGDCRFHIB?bib=",bib, "&fieldname=Lap81Minus&value=1")
writeClipboard(t)
t <- p0("https://api.raceresult.com/316629/RPQA6LDZJSBY9AIHPFAIAZPKGDCRFHIB?bib=",bib, "&fieldname=Lap81Minus&value=1")
writeClipboard(t)
url <- "https://api.raceresult.com/315977/4TV4B6CVD10OOGLG5KYUUWZ30GFO2PYA"
fromJson(url)
fromJSON(url)
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
# Sys.setlocale('LC_ALL', 'German')
suppressWarnings(suppressMessages(source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")))
url <- "https://api.raceresult.com/315977/4TV4B6CVD10OOGLG5KYUUWZ30GFO2PYA"
fromJSON(url)
results <- data.table(jsonlite::fromJSON(url(url), flatten = TRUE))
results
url(url)
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
# Sys.setlocale('LC_ALL', 'German')
suppressWarnings(suppressMessages(source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")))
url <- "https://api.raceresult.com/315977/4TV4B6CVD10OOGLG5KYUUWZ30GFO2PYA"
data <- data.table(jsonlite::fromJSON(url(url), flatten = TRUE))
setnames(data, names(data), c("Contest","Firstname","Lastname","Nation","UCI_ID"))
data
data[, .N, UCI_ID][N>1]
data[UCI_ID != "", .N, UCI_ID][N>1]
data[UCI_ID %IN% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID]
data[UCI_ID %in% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID]
data[UCI_ID %in% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID][order(UCI_ID)]
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
# Sys.setlocale('LC_ALL', 'German')
suppressWarnings(suppressMessages(source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")))
url <- "https://api.raceresult.com/315977/4TV4B6CVD10OOGLG5KYUUWZ30GFO2PYA"
data <- data.table(jsonlite::fromJSON(url(url), flatten = TRUE))
setnames(data, names(data), c("Contest","Firstname","Lastname","Nation","UCI_ID", "Bib"))
data[UCI_ID %in% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID][order(UCI_ID)]
data[Contest != 100][UCI_ID %in% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID][order(UCI_ID)]
data[Contest != 100][UCI_ID %in% data[UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID][order(UCI_ID, Contest)]
data[Contest != 100][UCI_ID %in% data[Contest != 100][UCI_ID != "", .N, UCI_ID][N>1]$UCI_ID][order(UCI_ID, Contest)]
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
# library(RecordLinkage)
library(stringdist)
data <- readAll(rP("file:///C:/Users/doria/Downloads/gdrive/RR/2025/2025______SwissBikeCup/BU/rr_backup_Skoda_Swiss_Bike_Cup_2025_20250507-100402/participants.csv"))
data
data[, Name := p0(Lastname, " ", Firstname)]
data <- data[, .(Contest, Name)]
lcontest <- u(data$Contest)
all <- data.table()
for(i in seq_along(lcontest)) {
data2 <- data[Contest == lcontest[i]]
data3 <- data.table(expand.grid(data2$Name, data2$Name))
data3[, Var1 := as.character.factor(Var1)]
data3[, Var2 := as.character.factor(Var2)]
data3[, dist := stringsim(Var1, Var2)]
data3 <- data3[dist != 1][dist > 0.5]
data3 <- data3[order(-dist)]
data3[, Contest := lcontest[i]]
all <- rbind(all, data3)
all <- all[order(-dist)]
}
all[1:50]
# setup
rm(list = ls())
rootpath <- "C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/"
Sys.setlocale("LC_ALL", "German")
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
suppressWarnings(suppressMessages(library(leaflet)))
suppressWarnings(suppressMessages(library(leaflet.extras)))
# suppressWarnings(suppressMessages(library(rayshaderanimate)))
suppressWarnings(suppressMessages(library(htmlwidgets)))
suppressWarnings(suppressMessages(library(RColorBrewer)))
suppressWarnings(suppressMessages(library(sf)))
suppressWarnings(suppressMessages(library(gpx)))
suppressWarnings(suppressMessages(library(xml2)))
# display.brewer.all()
wd <- rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/Bike_trip_2022/")
wdout <- rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/html_output/")
setwd(wd)
cat("\nwd = ", wd)
ll <- data.table(path = list.files(wd, pattern = "gpx$", full = T, recursive = T))
ll
# setup
rm(list = ls())
rootpath <- "C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/"
Sys.setlocale("LC_ALL", "German")
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
suppressWarnings(suppressMessages(library(leaflet)))
suppressWarnings(suppressMessages(library(leaflet.extras)))
# suppressWarnings(suppressMessages(library(rayshaderanimate)))
suppressWarnings(suppressMessages(library(htmlwidgets)))
suppressWarnings(suppressMessages(library(RColorBrewer)))
suppressWarnings(suppressMessages(library(sf)))
suppressWarnings(suppressMessages(library(gpx)))
suppressWarnings(suppressMessages(library(xml2)))
# display.brewer.all()
wdout <- rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/html_output/")
ll <- rbind(data.table(path = list.files(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/Bike_trip_2022/"), pattern = "gpx$", full = T, recursive = T)),
data.table(path = list.files(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/Bike_trip_2025/"), pattern = "gpx$", full = T, recursive = T)))
ll
# setup
rm(list = ls())
rootpath <- "C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/"
Sys.setlocale("LC_ALL", "German")
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
suppressWarnings(suppressMessages(library(leaflet)))
suppressWarnings(suppressMessages(library(leaflet.extras)))
# suppressWarnings(suppressMessages(library(rayshaderanimate)))
suppressWarnings(suppressMessages(library(htmlwidgets)))
suppressWarnings(suppressMessages(library(RColorBrewer)))
suppressWarnings(suppressMessages(library(sf)))
suppressWarnings(suppressMessages(library(gpx)))
suppressWarnings(suppressMessages(library(xml2)))
# display.brewer.all()
wdout <- rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/html_output/")
# read gpx ----------------------------------------------------------------
ll <- rbind(data.table(path = list.files(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/Bike_trip_2022/"), pattern = "gpx$", full = T, recursive = T)),
data.table(path = list.files(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/Bike_trip_2025/"), pattern = "gpx$", full = T, recursive = T)))
ll2 <- data.table(path = list.files(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/Leaflet/"), pattern = "gpx$", full = T, recursive = T))
ll <- rbind(ll, ll2)
ll[, file := basename(path)]
ll[, What := basename(dirname(path))]
ll[, colorID := .GRP, What]
ll[, .N, colorID]
ll[, color := brewer.pal(n = length(u(ll$colorID)), name = "Set1")[colorID]]
# ll[, color := qualitative_hcl(length(u(ll$colorID)), palette = "Dark 3")[colorID]]
ll[, .N, .(colorID, color)]
ll[, desc := p0(file, '<br><a target="_blank" href="https://raw.githubusercontent.com/DGrv/dorian-gravier/refs/heads/master/files/gpx/', What, "/", file, ' download>Download</a>')]
ll <- ll[!What %like% "time|Project|Stop"]
ll[, .N, What]
ll[What %like% "Bike", What := "Bike"]
ll[, .N, What]
# setup
rm(list = ls())
rootpath <- "C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/"
Sys.setlocale("LC_ALL", "German")
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
suppressWarnings(suppressMessages(library(leaflet)))
suppressWarnings(suppressMessages(library(leaflet.extras)))
# suppressWarnings(suppressMessages(library(rayshaderanimate)))
suppressWarnings(suppressMessages(library(htmlwidgets)))
suppressWarnings(suppressMessages(library(RColorBrewer)))
suppressWarnings(suppressMessages(library(sf)))
suppressWarnings(suppressMessages(library(gpx)))
suppressWarnings(suppressMessages(library(xml2)))
# display.brewer.all()
wdout <- rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/html_output/")
# read gpx ----------------------------------------------------------------
ll <- rbind(data.table(path = list.files(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/Bike_trip_2022/"), pattern = "gpx$", full = T, recursive = T)),
data.table(path = list.files(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/Bike_trip_2025/"), pattern = "gpx$", full = T, recursive = T)))
ll2 <- data.table(path = list.files(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/Leaflet/"), pattern = "gpx$", full = T, recursive = T))
ll <- rbind(ll, ll2)
ll[, file := basename(path)]
ll[, What := basename(dirname(path))]
ll[, colorID := .GRP, What]
ll[, .N, colorID]
ll[, color := brewer.pal(n = length(u(ll$colorID)), name = "Set1")[colorID]]
# ll[, color := qualitative_hcl(length(u(ll$colorID)), palette = "Dark 3")[colorID]]
ll[, .N, .(colorID, color)]
ll[, desc := p0(file, '<br><a target="_blank" href="https://raw.githubusercontent.com/DGrv/dorian-gravier/refs/heads/master/files/gpx/', What, "/", file, ' download>Download</a>')]
ll <- ll[!What %like% "time|Project|Stop"]
ll[, .N, What]
ll[What %like% "Bike", What := "Bike"]
ll[, .N, What]
data <- data.table()
for (i in seq_along(ll$path)) {
cat(i, "- Try:", ll$file[i])
temp <- read.gpx(ll$path[i], type="trk")
temp[, file := ll$file[i]]
temp[, What := ll$What[i]]
data <- rbind(data, temp, fill = T)
cat(green(" - Read done\n"))
}
data[, uname := p0(file, " - ", name)]
dataBU <- copy(data)
# # Old
# data <- data.table()
# for(i in seq_along(ll)) {
#   temp <- read.gpx(ll[i], type="wpt")
#   data <- rbind(data, temp)
# }
# brewer.pal(n = 2, name = "Set1")
mapGroups <- c(
"CyclOSM",
"OpenTopoMap",
"SwissTopo",
"SwissTopo Sat",
"Esri.WorldImagery",
"CartoDBPositron",
"CartoDBDarkMatter",
"CartoDBVoyager",
"OPNVKarte")
# check providers https://leaflet-extras.github.io/leaflet-providers/preview/
m <- leaflet() %>%
addProviderTiles( group = mapGroups[1], options = providerTileOptions(maxZoom = 20), "CyclOSM") %>%
addProviderTiles( group = mapGroups[2], options = providerTileOptions(maxZoom = 20), "OpenTopoMap") %>%
addProviderTiles( group = mapGroups[3], options = providerTileOptions(maxZoom = 20), "SwissFederalGeoportal.NationalMapColor") %>%
addProviderTiles( group = mapGroups[4], options = providerTileOptions(maxZoom = 20), "SwissFederalGeoportal.SWISSIMAGE") %>%
addProviderTiles( group = mapGroups[5], options = providerTileOptions(maxZoom = 20), "Esri.WorldImagery") %>%
addProviderTiles( group = mapGroups[6], options = providerTileOptions(maxZoom = 20), "CartoDB.PositronNoLabels")%>%
addProviderTiles( group = mapGroups[7], options = providerTileOptions(maxZoom = 20), "CartoDB.DarkMatterNoLabels") %>%
addProviderTiles( group = mapGroups[8], options = providerTileOptions(maxZoom = 20), "CartoDB.VoyagerNoLabels") %>%
addProviderTiles( group = mapGroups[9], options = providerTileOptions(maxZoom = 20), "OPNVKarte")
m <- m %>%
onRender("
function(el, x) {
var map = this;
map.options.zoomSnap = 0.5;
map.options.zoomDelta = 0.5;
}
")
# Add layers --------------------------------------------------------------
groupLayers <- c(u(ll$What), "Huts", "Wild Camping")
u(data$uname)
for(i in seq_along(u(data$name)) ) {
data1 <- st_as_sf(x = data[uname == u(data$uname)[i]],
coords = c("lon", "lat"))
data2 <- data1 %>%
st_combine() %>%
st_cast(to = "LINESTRING") %>%
st_sf()
ll2 <- ll[file == data[uname == u(data$uname)[i]]$file[1]]
m <- m %>%
addPolylines(data = data2,
group = ll2$What,
color = ll2$color,
popup = ll2$desc,
opacity=1,
weight=4
# label = ~name
)
}
# icon/hutte.png
hutte <- data.table(read.csv(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/DAV_hutte_coord.csv")))
hutte[, popup := p0(Name, '<br><a href="', link, '">Infos</a>')]
zelt <- read.gpx(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/Zelt.gpx"), type = "wpt")
rrIcons <- iconList(
hut = makeIcon(
iconUrl = "https://raw.githubusercontent.com/DGrv/dorian-gravier/refs/heads/master/files/icon/hutte.png",
iconWidth = 36,
iconHeight = 36
),
camp = makeIcon(
iconUrl = "https://raw.githubusercontent.com/DGrv/dorian-gravier/refs/heads/master/files/icon/camping.png",
iconWidth = 36,
iconHeight = 36
)
)
m <- m %>%
addMarkers(data = hutte, lng = ~lon, lat = ~lat,
group = "Huts",
# color = "#ff3355",
icon = rrIcons["hut"],
popup = ~popup
# popupOptions = popupOptions(autoClose = TRUE, offset=c(0, -10)),
# opacity = 1,
# radius = 4,
# fillOpacity = 0.5
) %>%
addMarkers(data = zelt, lng = ~lon, lat = ~lat,
group = "Wild Camping",
# color = "#ff3355",
icon = rrIcons["camp"]
# popup = ~SplitName,
# popupOptions = popupOptions(autoClose = TRUE, offset=c(0, -30)),
# opacity = 1,
# radius = 4,
# fillOpacity = 0.5
)
# output ------------------------------------------------------------------
# m <- setView(map=m, lng=(max(data$lon)-min(data$lon))/2+min(data$lon),
#              lat=(max(data$lat)-min(data$lat))/2+min(data$lat),
#              zoom = 6, options = )
m <-  m %>%
setView(5.142, 44.536,  zoom = 6) %>%
addLayersControl(
baseGroups = mapGroups,
overlayGroups = groupLayers,
options = layersControlOptions(collapsed=FALSE)) %>%
addFullscreenControl() %>%
addHash() %>%
addSearchOSM() %>%
addControlGPS() %>%
hideGroup("Huts")
# %>%
# hideGroup(groupslayer[3:length(groupslayer)]) #hide all groups except the 1st and 2nd )
cat("\nLeaflet ready")
setwd(wdout)
saveWidget(m, file="Leaflet.html")
cat("\nLeaflet DONE :)\n")
export.gpx2(data[What == "Bike"],
rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/All_Bikes_for_gpxstudio.gpx"),
layer.type = "trk",
segment.column.name = "uname")
