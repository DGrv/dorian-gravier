# a <- ggplot(temp, aes(lon, lat))+geom_point()+
#   geom_polygon(data=world2, aes(long, lat, group = group), colour='black', fill=NA)+
#   geom_point(data = data, aes(lon, lat), color = "red")+
#   labs(title = titlegg)
# a
}
data[, name := gsub('\\"', "", name)]
data[, numberAscents := as.numeric(numberAscents)]
data[, numberRoutes := as.numeric(numberRoutes)]
data[is.na(numberAscents), numberAscents := 0]
data[is.na(numberRoutes), numberRoutes := 0]
data[, url := p0("https://www.thecrag.com/climbing/", stub)]
data <- data[!is.na(lon)][!is.na(lat)]
# new filter
temp <- data[, .SD[stub %like% stub, .N], by = stub]
data <- dtjoin(data, temp)
setnames(data, "V1", "nstub")
data <- data[nstub == 1][numberRoutes>0 & numberAscents > 0 ]
data[, desc := p0("Routes:", numberRoutes, " - Ascents:", numberAscents, "\n")]
data[, country := gsub("^(.*?)\\/.*", "\\1", stub)]
data[, .N, country]
data[, filterNroutes := F]
data[numberRoutes >= nminRoutes, filterNroutes := T]
a <- ggplot(data, aes(lon, lat))+ geom_point(aes(color=filterNroutes))+
geom_polygon(data=world2, aes(long, lat, group = group), colour='black', fill=NA)
a
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
# Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, 'BM_Function_v01.r'), encoding='utf-8')
# user choices ------------------------------------------------------------
country.list <- c("Greece")
nminRoutes <- 100
wd <- rP("file:///C:/Users/doria/Downloads/Outdoor/Gpx/thecrag/json/")
wdout <- rP("file:///C:/Users/doria/Downloads/Outdoor/Gpx/thecrag/")
# area and tiles ----------------------------------------------------------
world <- data.table(map_data("world"))
world2 <- world[region %like% paste0(country.list, collapse = "|")]
world2[, .N, region]
ggplot(world2, aes(long, lat, group = group))+
geom_polygon(colour='black', fill=NA)
# Leaflet localisation --------------------------------------------------------------------
setwd(wd)
ll <- list.files(wd, pattern = "*.json")
data <- data.table()
for(i in seq_along(ll)) {
cat("\nFile:\t", green(ll[i]))
t0 <- jsonlite::fromJSON(ll[i], flatten = TRUE)
# extract data -----
# https://www.r-bloggers.com/2018/10/converting-nested-json-to-a-tidy-data-frame-with-r/
d <- data.table(enframe(unlist(t0)))[name %like% "children"][name %like% "name|stub|numberRoutes|numberAscents|center"]
if( nrow(d) > 0 ) {
d[, id := gsub("\\d*", "", basename(gsub("\\.", "/", name)))]
d[, children.id := str_count(name, "children")]
d[, row := 1:.N]
d <- d[order(children.id, row)]
d3 <- d[name %like% "stub|numberRoutes|numberAscents"]
d3[, variable := gsub("\\d", "", gsub(".*children.", "",  name))]
d3[, row := 1:.N, variable]
d3 <- dcast.data.table(d3[, .(value, variable, row)], row~variable, value.var = "value")
d3 <- d3[order(row)]
d3
d3[, lon := as.numeric(d[name %like% "center"][seq(1, nrow(d3)*2, 2)]$value)]
d3[, lat := as.numeric(d[name %like% "center"][seq(2, nrow(d3)*2, 2)]$value)]
d3[, name := d[name %like% "name"]$value]
d3[, row := NULL]
# bind and count -------
data <- rbind(data, u(d3))
data <-  data[lat > min(world2$lat) & lon > min(world2$long) & lat < max(world2$lat) & lon < max(world2$long)]
data <- u(data)
}
# # print plot and info-----
# a <- ggplot(temp, aes(lon, lat))+geom_point()+
#   geom_polygon(data=world2, aes(long, lat, group = group), colour='black', fill=NA)+
#   geom_point(data = data, aes(lon, lat), color = "red")+
#   labs(title = titlegg)
# a
}
data[, name := gsub('\\"', "", name)]
data[, numberAscents := as.numeric(numberAscents)]
data[, numberRoutes := as.numeric(numberRoutes)]
data[is.na(numberAscents), numberAscents := 0]
data[is.na(numberRoutes), numberRoutes := 0]
data[, url := p0("https://www.thecrag.com/climbing/", stub)]
data <- data[!is.na(lon)][!is.na(lat)]
# new filter
temp <- data[, .SD[stub %like% stub, .N], by = stub]
data <- dtjoin(data, temp)
setnames(data, "V1", "nstub")
data <- data[nstub == 1][numberRoutes>0 & numberAscents > 0 ]
data[, desc := p0("Routes:", numberRoutes, " - Ascents:", numberAscents, "\n")]
data[, country := gsub("^(.*?)\\/.*", "\\1", stub)]
data[, .N, country]
data[, filterNroutes := F]
data[numberRoutes >= nminRoutes, filterNroutes := T]
a <- ggplot(data, aes(lon, lat))+ geom_point(aes(color=filterNroutes))+
geom_polygon(data=world2, aes(long, lat, group = group), colour='black', fill=NA)
a
setwd(wdout)
for(i in seq_along(country.list)) {
filenameout <- p0(wd, "th3cra4g_", country.list[i])
export.gpx2(data[grepl(country.list[i], country, ignore.case = T)], p0(filenameout , ".gpx"))
temp <- data[grepl(country.list[i], country, ignore.case = T), .(name,
coord=p0(lat,",", lon),
desc = p0(desc, "\n<a href='", url, "' target='_blank'>Thecrag link</a>"),
group="Climbing")]
temp
write.table(temp, p0(filenameout, ".tsv"), sep = "\t",  fileEncoding = "UTF-8", row.names = F)
}
# setup
rm(list = ls())
rootpath <- "C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/"
Sys.setlocale("LC_ALL", "German")
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
suppressWarnings(suppressMessages(library(leaflet)))
suppressWarnings(suppressMessages(library(leaflet.extras)))
# suppressWarnings(suppressMessages(library(rayshaderanimate)))
suppressWarnings(suppressMessages(library(htmlwidgets)))
suppressWarnings(suppressMessages(library(RColorBrewer)))
suppressWarnings(suppressMessages(library(sf)))
suppressWarnings(suppressMessages(library(gpx)))
suppressWarnings(suppressMessages(library(xml2)))
# display.brewer.all()
wd <- rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/PlanMap/")
wdout <- rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/html_output/")
setwd(wd)
cat("\nwd = ", wd)
# read gpx ----------------------------------------------------------------
ll <- data.table(path = list.files(wd, pattern = "gpx$", full = T, recursive = T))
ll[, file := basename(path)]
ll[, What := basename(dirname(path))]
ll[, colorID := .GRP, What]
ll[, .N, colorID]
ll[, color := brewer.pal(n = length(u(ll$colorID)), name = "Set1")[colorID]]
# ll[, color := qualitative_hcl(length(u(ll$colorID)), palette = "Dark 3")[colorID]]
ll[, .N, .(colorID, color)]
ll[, desc := p0(file, '<br><a target="_blank" href="https://raw.githubusercontent.com/DGrv/dorian-gravier/refs/heads/master/files/gpx/', What, "/", file, '" download>Download</a>')]
ll <- ll[What!= "time"]
data <- data.table()
for (i in seq_along(ll$path)) {
cat(i, "- Try:", ll$file[i])
temp <- read.gpx(ll$path[i], type="trk")
temp[, file := ll$file[i]]
temp[, What := ll$What[i]]
temp[, isStart := F]
temp[1, isStart := T]
data <- rbind(data, temp, fill = T)
cat(green(" - Read done\n"))
}
# # Old
# data <- data.table()
# for(i in seq_along(ll)) {
#   temp <- read.gpx(ll[i], type="wpt")
#   data <- rbind(data, temp)
# }
# brewer.pal(n = 2, name = "Set1")
source(p0(rootpath, "Map_Github/Map_providers.R"))
# Load POI data -----------------------------------------------------------
poi <- readAll(list.files(wd, pattern = ".tsv"))
poi
poi[, lat := as.numeric(gsub("(.*),(.*)", "\\1", coord))]
poi[, lon := as.numeric(gsub("(.*),(.*)", "\\2", coord))]
poi[, groupID := .GRP+1, group]
poi[, color := brewer.pal(n = length(u(poi$group))+1, name = "Set1")[groupID]]
poi[, popup := p0("<b>", name, "</b><br>", desc)]
poi
poiGroup <- u(poi$group)
# Add layers --------------------------------------------------------------
groupLayers <- c(u(ll$What), poiGroup)
for(i in seq_along(ll$file)) {
data1 <- st_as_sf(x = data[file == ll$file[i]],
coords = c("lon", "lat"))
data2 <- data1 %>%
st_combine() %>%
st_cast(to = "LINESTRING") %>%
st_sf()
m <- m %>%
addPolylines(data = data2,
group = ll$What[i],
color = ll$color[i],
popup = ll$desc[i],
opacity = ifelse(ll$What[i]=="Stop", 0.4, 1),
weight = 4
# label = ~name
)
}
# rrIcons <- iconList(
#   camp = makeIcon(
#     iconUrl = "https://raw.githubusercontent.com/DGrv/dorian-gravier/refs/heads/master/files/icon/camping.png",
#     iconWidth = 36,
#     iconHeight = 36
#   )
# )
# m <- m %>%
#   addMarkers(data = zelt, lng = ~lon, lat = ~lat,
#              group = "Wild Camping",
#              # color = "#ff3355",
#              icon = rrIcons["camp"]
#              # popup = ~SplitName,
#              # popupOptions = popupOptions(autoClose = TRUE, offset=c(0, -30)),
#              # opacity = 1,
#              # radius = 4,
#              # fillOpacity = 0.5
#   )
m <- m %>%
addCircleMarkers(data = poi, lng = ~lon, lat = ~lat,
group = ~group,
color = ~color,
popup = ~popup,
# popupOptions = popupOptions(autoClose = TRUE, offset=c(0, -30)),
popupOptions = popupOptions(autoClose = TRUE, offset=c(0, 0)),
opacity = 1,
radius = 10,
fillOpacity = 0.8)
# output ------------------------------------------------------------------
latMiddle <- (max(data$lat)-min(data$lat))/2+min(data$lat)
lonMiddle <- (max(data$lon)-min(data$lon))/2+min(data$lon)
m <- setView(map=m,
lat= latMiddle,
lng= lonMiddle,
zoom = 7, options = )
m <-  m %>%
# setView(11, 45,  zoom = 6) %>%
addLayersControl(
baseGroups = mapGroups,
overlayGroups = groupLayers,
options = layersControlOptions(collapsed=FALSE)) %>%
addFullscreenControl() %>%
addHash() %>%
addSearchOSM() %>%
addControlGPS()
# %>%
#   hideGroup("Wild Camping")
# %>% C:\Users\doria\Downloads\GitHub\dorian.gravier.github.io\files\R\Map_Github\Leaflet_github.R
# hideGroup(groupslayer[3:length(groupslayer)]) #hide all groups except the 1st and 2nd )
cat("\nLeaflet ready")
setwd(wdout)
outfilename <- "PlanMap.html"
saveWidget(m, file=outfilename)
# change few thing in the html
t <- readLines(outfilename)
idwidget <- gsub('<script type\\="application/htmlwidget-sizing" data-for\\="(.*)">\\{"viewer".*', "\\1", t[length(t)-2])
# change meta that is good phones
# t[t %like% "<meta"]
t <- gsub(t[t %like% "<meta"], '<meta charset="utf-8" />\n<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />', t)
t <- gsub("<title>leaflet</title>", p0("<title>", gsub(".html", "", outfilename), "</title>"), t)
# Mouse position ---------------------------------------------------------
tadd <- readLines(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/RR/Javascript/Copy_MousePosition_v01.html"))
tadd <- gsub("\\#idwidget", p0("#", idwidget), tadd)
t <- c(t[1:(length(t)-2)], tadd, t[(length(t)-1):length(t)])
write.table(t, outfilename, row.names = F, col.names = F, quote = F)
cat("\nLeaflet DONE :)\n")
# setup
rm(list = ls())
rootpath <- 'C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/'
# Sys.setlocale('LC_ALL', 'German')
source(paste0(rootpath, 'BM_Function_v01.r'), encoding='utf-8')
# Explanation -------------------------------------------------------------
# go on the map from the crag and choose the zoom you wanna have data, then move around and it should load in the Networt tab from devtool some "heirachy" which are json data for the leaflet
# once you are done go in the console and run :
# it will download all those json.
# then mv them in your wd and change user choices
# // Grab all network requests in the current session
# performance.getEntriesByType("resource")
# .filter(r => r.name.includes("heir")) // change this to match your filter
# .forEach((r, i) => {
#   fetch(r.name)
#   .then(resp => resp.text())
#   .then(text => {
#     // Save each file (will prompt download)
#     const blob = new Blob([text], {type: "text/plain"});
#     const a = document.createElement("a");
#     a.href = URL.createObjectURL(blob);
#     a.download = `resp_${i}.json`; // change extension if needed
#     a.click();
#   });
# });
# user choices ------------------------------------------------------------
country.list <- c("Greece")
nminRoutes <- 100
wd <- rP("file:///C:/Users/doria/Downloads/Outdoor/Gpx/thecrag/greece/")
# area and tiles ----------------------------------------------------------
world <- data.table(map_data("world"))
world2 <- world[region %like% paste0(country.list, collapse = "|")]
world2[, .N, region]
ggplot(world2, aes(long, lat, group = group))+
geom_polygon(colour='black', fill=NA)
# Leaflet localisation --------------------------------------------------------------------
setwd(wd)
ll <- list.files(wd, pattern = "*.json")
data <- data.table()
for(i in seq_along(ll)) {
cat("\nFile:\t", green(ll[i]))
t0 <- jsonlite::fromJSON(ll[i], flatten = TRUE)
# extract data -----
# https://www.r-bloggers.com/2018/10/converting-nested-json-to-a-tidy-data-frame-with-r/
d <- data.table(enframe(unlist(t0)))[name %like% "children"][name %like% "name|stub|numberRoutes|numberAscents|center"]
if( nrow(d) > 0 ) {
d[, id := gsub("\\d*", "", basename(gsub("\\.", "/", name)))]
d[, children.id := str_count(name, "children")]
d[, row := 1:.N]
d <- d[order(children.id, row)]
d3 <- d[name %like% "stub|numberRoutes|numberAscents"]
d3[, variable := gsub("\\d", "", gsub(".*children.", "",  name))]
d3[, row := 1:.N, variable]
d3 <- dcast.data.table(d3[, .(value, variable, row)], row~variable, value.var = "value")
d3 <- d3[order(row)]
d3
d3[, lon := as.numeric(d[name %like% "center"][seq(1, nrow(d3)*2, 2)]$value)]
d3[, lat := as.numeric(d[name %like% "center"][seq(2, nrow(d3)*2, 2)]$value)]
d3[, name := d[name %like% "name"]$value]
d3[, row := NULL]
# bind and count -------
data <- rbind(data, u(d3))
data <-  data[lat > min(world2$lat) & lon > min(world2$long) & lat < max(world2$lat) & lon < max(world2$long)]
data <- u(data)
}
# # print plot and info-----
# a <- ggplot(temp, aes(lon, lat))+geom_point()+
#   geom_polygon(data=world2, aes(long, lat, group = group), colour='black', fill=NA)+
#   geom_point(data = data, aes(lon, lat), color = "red")+
#   labs(title = titlegg)
# a
}
data[, name := gsub('\\"', "", name)]
data[, numberAscents := as.numeric(numberAscents)]
data[, numberRoutes := as.numeric(numberRoutes)]
data[is.na(numberAscents), numberAscents := 0]
data[is.na(numberRoutes), numberRoutes := 0]
data[, url := p0("https://www.thecrag.com/climbing/", stub)]
data <- data[!is.na(lon)][!is.na(lat)]
# new filter
temp <- data[, .SD[stub %like% stub, .N], by = stub]
data <- dtjoin(data, temp)
setnames(data, "V1", "nstub")
data <- data[nstub == 1][numberRoutes>0 & numberAscents > 0 ]
data[, desc := p0("Routes:", numberRoutes, " - Ascents:", numberAscents, "\n")]
data[, country := gsub("^(.*?)\\/.*", "\\1", stub)]
data[, .N, country]
data[, filterNroutes := F]
data[numberRoutes >= nminRoutes, filterNroutes := T]
a <- ggplot(data, aes(lon, lat))+ geom_point(aes(color=filterNroutes))+
geom_polygon(data=world2, aes(long, lat, group = group), colour='black', fill=NA)
a
for(i in seq_along(country.list)) {
filenameout <- p0(wd, "th3cra4g_", country.list[i])
export.gpx2(data[grepl(country.list[i], country, ignore.case = T)], p0(filenameout , ".gpx"))
temp <- data[grepl(country.list[i], country, ignore.case = T), .(name,
coord=p0(lat,",", lon),
desc = p0(desc, "\n<a href='", url, "' target='_blank'>Thecrag link</a>"),
group="Climbing")]
temp
write.table(temp, p0(filenameout, "_for_PlanMap.tsv"), sep = "\t",  fileEncoding = "UTF-8", row.names = F)
}
data2 <- data[filterNroutes == T]
a <- ggplot(data, aes(lon, lat))+ geom_point(aes(color=filterNroutes))+
geom_polygon(data=world2, aes(long, lat, group = group), colour='black', fill=NA)
a
for(i in seq_along(country.list)) {
filenameout <- p0(wd, "th3cra4g_", country.list[i])
export.gpx2(data2[grepl(country.list[i], country, ignore.case = T)], p0(filenameout , ".gpx"))
temp <- data2[grepl(country.list[i], country, ignore.case = T), .(name,
coord=p0(lat,",", lon),
desc = p0(desc, "\n<a href='", url, "' target='_blank'>Thecrag link</a>"),
group="Climbing")]
temp
write.table(temp, p0(filenameout, "_for_PlanMap.tsv"), sep = "\t",  fileEncoding = "UTF-8", row.names = F)
}
# setup
rm(list = ls())
rootpath <- "C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/R/"
Sys.setlocale("LC_ALL", "German")
source(paste0(rootpath, "BM_Function_v01.r"), encoding="utf-8")
suppressWarnings(suppressMessages(library(leaflet)))
suppressWarnings(suppressMessages(library(leaflet.extras)))
# suppressWarnings(suppressMessages(library(rayshaderanimate)))
suppressWarnings(suppressMessages(library(htmlwidgets)))
suppressWarnings(suppressMessages(library(RColorBrewer)))
suppressWarnings(suppressMessages(library(sf)))
suppressWarnings(suppressMessages(library(gpx)))
suppressWarnings(suppressMessages(library(xml2)))
# display.brewer.all()
wd <- rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/PlanMap/")
wdout <- rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/gpx/html_output/")
setwd(wd)
cat("\nwd = ", wd)
# read gpx ----------------------------------------------------------------
ll <- data.table(path = list.files(wd, pattern = "gpx$", full = T, recursive = T))
ll[, file := basename(path)]
ll[, What := basename(dirname(path))]
ll[, colorID := .GRP, What]
ll[, .N, colorID]
ll[, color := brewer.pal(n = length(u(ll$colorID)), name = "Set1")[colorID]]
# ll[, color := qualitative_hcl(length(u(ll$colorID)), palette = "Dark 3")[colorID]]
ll[, .N, .(colorID, color)]
ll[, desc := p0(file, '<br><a target="_blank" href="https://raw.githubusercontent.com/DGrv/dorian-gravier/refs/heads/master/files/gpx/', What, "/", file, '" download>Download</a>')]
ll <- ll[What!= "time"]
data <- data.table()
for (i in seq_along(ll$path)) {
cat(i, "- Try:", ll$file[i])
temp <- read.gpx(ll$path[i], type="trk")
temp[, file := ll$file[i]]
temp[, What := ll$What[i]]
temp[, isStart := F]
temp[1, isStart := T]
data <- rbind(data, temp, fill = T)
cat(green(" - Read done\n"))
}
# # Old
# data <- data.table()
# for(i in seq_along(ll)) {
#   temp <- read.gpx(ll[i], type="wpt")
#   data <- rbind(data, temp)
# }
# brewer.pal(n = 2, name = "Set1")
source(p0(rootpath, "Map_Github/Map_providers.R"))
# Load POI data -----------------------------------------------------------
poi <- readAll(list.files(wd, pattern = ".tsv"))
poi
poi[, lat := as.numeric(gsub("(.*),(.*)", "\\1", coord))]
poi[, lon := as.numeric(gsub("(.*),(.*)", "\\2", coord))]
poi[, groupID := .GRP+1, group]
poi[, color := brewer.pal(n = length(u(poi$group))+1, name = "Set1")[groupID]]
poi[, popup := p0("<b>", name, "</b><br>", desc)]
poi
poiGroup <- u(poi$group)
# Add layers --------------------------------------------------------------
groupLayers <- c(u(ll$What), poiGroup)
for(i in seq_along(ll$file)) {
data1 <- st_as_sf(x = data[file == ll$file[i]],
coords = c("lon", "lat"))
data2 <- data1 %>%
st_combine() %>%
st_cast(to = "LINESTRING") %>%
st_sf()
m <- m %>%
addPolylines(data = data2,
group = ll$What[i],
color = ll$color[i],
popup = ll$desc[i],
opacity = ifelse(ll$What[i]=="Stop", 0.4, 1),
weight = 4
# label = ~name
)
}
# rrIcons <- iconList(
#   camp = makeIcon(
#     iconUrl = "https://raw.githubusercontent.com/DGrv/dorian-gravier/refs/heads/master/files/icon/camping.png",
#     iconWidth = 36,
#     iconHeight = 36
#   )
# )
# m <- m %>%
#   addMarkers(data = zelt, lng = ~lon, lat = ~lat,
#              group = "Wild Camping",
#              # color = "#ff3355",
#              icon = rrIcons["camp"]
#              # popup = ~SplitName,
#              # popupOptions = popupOptions(autoClose = TRUE, offset=c(0, -30)),
#              # opacity = 1,
#              # radius = 4,
#              # fillOpacity = 0.5
#   )
m <- m %>%
addCircleMarkers(data = poi, lng = ~lon, lat = ~lat,
group = ~group,
color = ~color,
popup = ~popup,
# popupOptions = popupOptions(autoClose = TRUE, offset=c(0, -30)),
popupOptions = popupOptions(autoClose = TRUE, offset=c(0, 0)),
opacity = 1,
radius = 10,
fillOpacity = 0.8)
# output ------------------------------------------------------------------
latMiddle <- (max(data$lat)-min(data$lat))/2+min(data$lat)
lonMiddle <- (max(data$lon)-min(data$lon))/2+min(data$lon)
m <- setView(map=m,
lat= latMiddle,
lng= lonMiddle,
zoom = 7, options = )
m <-  m %>%
# setView(11, 45,  zoom = 6) %>%
addLayersControl(
baseGroups = mapGroups,
overlayGroups = groupLayers,
options = layersControlOptions(collapsed=FALSE)) %>%
addFullscreenControl() %>%
addHash() %>%
addSearchOSM() %>%
addControlGPS()
# %>%
#   hideGroup("Wild Camping")
# %>% C:\Users\doria\Downloads\GitHub\dorian.gravier.github.io\files\R\Map_Github\Leaflet_github.R
# hideGroup(groupslayer[3:length(groupslayer)]) #hide all groups except the 1st and 2nd )
cat("\nLeaflet ready")
setwd(wdout)
outfilename <- "PlanMap.html"
saveWidget(m, file=outfilename)
# change few thing in the html
t <- readLines(outfilename)
idwidget <- gsub('<script type\\="application/htmlwidget-sizing" data-for\\="(.*)">\\{"viewer".*', "\\1", t[length(t)-2])
# change meta that is good phones
# t[t %like% "<meta"]
t <- gsub(t[t %like% "<meta"], '<meta charset="utf-8" />\n<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />', t)
t <- gsub("<title>leaflet</title>", p0("<title>", gsub(".html", "", outfilename), "</title>"), t)
# Mouse position ---------------------------------------------------------
tadd <- readLines(rP("file:///C:/Users/doria/Downloads/GitHub/dorian.gravier.github.io/files/RR/Javascript/Copy_MousePosition_v01.html"))
tadd <- gsub("\\#idwidget", p0("#", idwidget), tadd)
t <- c(t[1:(length(t)-2)], tadd, t[(length(t)-1):length(t)])
write.table(t, outfilename, row.names = F, col.names = F, quote = F)
cat("\nLeaflet DONE :)\n")
